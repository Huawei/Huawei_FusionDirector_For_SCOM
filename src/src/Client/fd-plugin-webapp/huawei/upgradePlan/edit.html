<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>修改计划</title>
    <link href="../../css/element.css" rel="stylesheet" />
    <link href="../../css/style.css" rel="stylesheet" />
    <script src="../../scripts/vue.js"></script>
    <script src="../../scripts/element.js"></script>
    <script src="../../scripts/jquery-3.2.1.min.js"></script>
    <script src="../../scripts/i18n/zh-CN.js"></script>
    <script src="../../scripts/i18n/en.js"></script>
    <script src="../i18n/en.js"></script>
    <script src="../i18n/zh-CN.js"></script>
    <script src="../../scripts/polyfill.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../../scripts/web-platform.js"></script>
    <script src="../js/errorCode.js"></script>
    <script src="../js/taskMessage.js"></script>
    <script src="../../scripts/lodash.min.js"></script>
    <script src="js/rest.js"></script>
    <style>
        [v-cloak] {
            display: none;
        }

        body {
            min-width: 900px;
        }
        .checkText{
            color: #999;
        }
        .checkText i{
            font-style: normal;
        }
        .checkText .descTo{
            color: #409eff;
            cursor: pointer;
            margin-right: 5px;
        }
        .el-icon-info {
            margin-right: 10px;
            color: #409eff;
        }

        .el-input-number span {
            background-color: #fff;
        }
        .steps{
            padding: 20px;
        }
        .mt20{
            margin: 20px 0;
        }
        .switch{
            margin-left: 10px;
            display: inline-block;
        }
        .fl{
            float: left;
        }
        .checkVisForm .el-upload-list {
            width: 450px;
        }
        .checkVisForm .el-select{
            width:420px;
        }
        .checkVisForm .el-input,.checkVisForm .el-textarea__inner  {
            width: 420px;
        }
        .checkVisForm .el-upload-list {
            width: 420px;
       }
        .desLength{
            position: absolute;
            bottom: 0px;
            left: 360px;
            color: #999;
            width: 50px;
            text-align: right;
       }
       /* 部署的下拉搜索框 */
       .input-with-select{
            display: inline-block;
            position: relative;
            vertical-align: middle;
        }
        .input-with-select .el-select{
            width: auto;
        }
        .input-with-select .el-select .el-input {
            width: 130px;
        }

        .serviceTit{
            display: inline-block;
            height: 30px;
            line-height: 30px;
            vertical-align: middle;
            margin-right: 10px;
        }
        .serviceTit i{
            width: 5px;
            height: 100%;
            background: #409eff;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        .radioDesc{
            color: #999;
            margin-left: 10px;
        }
        .add_table_header .el-checkbox__inner{
            display: none;
        }
        .packageSearch{
            margin-bottom: 10px;
        }
        .group_table_header .el-checkbox__inner,.device_table_header .el-checkbox__inner{
            cursor: not-allowed;
            background: #edf2fc;
        }
        .productType .el-form-item__label:before{
            content: '*';
            color: #f56c6c;
            margin-right: 3px;
        }
        .packageSearch .el-select-multiple{
            min-width: 410px;
        }
        .el-dialog{
            min-width: 830px;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <el-row v-loading.fullscreen.lock="editLoading">
            <div>
                <el-row>
                    <h2>{{i18ns.upgradePackage.infoMessage}}</h2>
                </el-row>
                <!-- 选择版本 -->
                <el-row>
                    <el-form class="checkVisForm" v-bind:model="upgradeForm" v-bind:rules="rules" ref="upgradeForm"
                        v-bind:label-width="labelWidth" label-position="left" label-suffix=":">
                        <div class="com-border-bottom">
                            <el-form-item label="Director">
                                <el-select v-model="FDIp" @change="commandClick" disabled>
                                    <el-option v-for="item in FDList" :key="item.value" :label="item.label" :value="item.value">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_planName" prop="PlanName">
                                <el-popover placement="right-start" trigger="hover" :content="i18ns.common.regExp_userName">
                                    <el-input slot="reference" :placeholder="i18ns.common.pleaseInput" v-model="upgradeForm.PlanName"
                                        class="input-with-select"></el-input>
                                </el-popover>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_planDescription" prop="Description">
                                <el-input :rows="5" type="textarea" v-model="upgradeForm.Description" maxlength="256"
                                    :placeholder="i18ns.OSDeploy.deploy_descriptionLimit"></el-input>
                                <span class="desLength"> <span>{{upgradeForm.Description.length}}</span>/256</span>
                            </el-form-item>
                            <el-row>
                                <h2>{{i18ns.upgradePackageWarehouse.versionWarehouse_versionMessage}}</h2>
                            </el-row>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_versionType" class="productType">
                                <el-radio-group v-model="upgradeForm.selectMethod" @change="switchType">
                                    <el-radio-button :label="'Baseline'">{{i18ns.upgradePlan.upgradePlan_baseline}}</el-radio-button>
                                    <el-radio-button :label="'UpgradePackage'">{{i18ns.upgradePlan.upgradePlan_upgradePackage}}</el-radio-button>
                                </el-radio-group>
                                <span v-if="upgradeForm.selectMethod=='Baseline'" class="checkText" style="margin-left:10px;">{{i18ns.upgradePlan.upgradePlan_baselineTip}}</span>
                                <span v-if="upgradeForm.selectMethod=='UpgradePackage'" class="checkText" style="margin-left:10px;">{{i18ns.upgradePlan.upgradePlan_upgradePackageTip}}</span>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_selectBaseline" v-if="upgradeForm.selectMethod=='Baseline'"
                                class="productType">
                                <span class="checkText">
                                    <i class="el-icon-info"></i>{{i18ns.upgradePlan.upgradePlan_selectBaselineCreate}}
                                    <i class="descTo" @click="toCreatBaseline">{{i18ns.upgradePlan.upgradePlan_clickHere}}</i>
                                    {{i18ns.upgradePlan.upgradePlan_customBaselineWord}}
                                </span>
                                <p style="float:right;margin: 0;">
                                    <el-button size="medium" @click="deleteAll" :disabled="uplistData.length<=0">{{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                                    <el-button size="medium" @click="checkBaseline">{{i18ns.common.add}}</el-button>
                                </p>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_selectUpgradePackage" v-if="upgradeForm.selectMethod=='UpgradePackage'"
                                class="productType">
                                <span class="checkText">
                                    <i class="el-icon-info"></i>{{i18ns.upgradePlan.upgradePlan_needUpgradePackage}}
                                    <i class="descTo" @click="toUpPackage">{{i18ns.upgradePlan.upgradePlan_clickHere}}</i>
                                    {{i18ns.upgradePlan.upgradePlan_uploadUpgradePackageWord}}
                                </span>
                                <p style="float:right;margin: 0;">
                                    <el-button size="medium" @click="deleteAll" :disabled="uplistData.length<=0">{{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                                    <el-button size="medium" @click="addUpgradePackage">{{i18ns.common.add}}</el-button>
                                </p>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_upgradeVersionInformation">

                            </el-form-item>
                            <el-row>
                                <template>
                                    <el-table v-bind:data="uplistData" style="width:100%;" v-loading="loading" key="uplistData"
                                        :element-loading-text="i18ns.common.loading" header-row-class-name="my_table_header">
                                        <el-table-column prop="PackageName" :label="i18ns.upgradePlan.upgradePlan_packageName"></el-table-column>
                                        <el-table-column prop="SupportModel" :label="i18ns.upgradePlan.upgradePlan_productDeviceType"></el-table-column>
                                        <el-table-column prop="Versions" :label="i18ns.upgradePlan.upgradePlan_version">
                                            <template slot-scope="scope">
                                                <p v-for="(item,i) in scope.row.Version" :key="i">
                                                    <span>{{item.Module}}:</span>
                                                    <span>{{item.CurrentVer}}</span>
                                                </p>
                                            </template>
                                        </el-table-column>
                                        <el-table-column prop="Size" :label="i18ns.upgradePackageWarehouse.versionWarehouse_size">
                                            <template slot-scope="scope">
                                                {{unitFun(scope.row.Size)}}
                                            </template>
                                        </el-table-column>
                                        <el-table-column :label="i18ns.common.operation">
                                            <template slot-scope="scope">
                                                <el-button type="text" size="small" @click="deleteOne(scope.row,scope.$index)">{{i18ns.common.delete}}</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                    <p style="text-align:right;" v-if="uplistData.length>0">{{i18ns.common.common_totalNumber}}{{uplistData.length}}</p>
                                </template>
                            </el-row>
                        </div>
                    </el-form>

                </el-row>
                <!-- 选择设备 -->
                <el-row>
                    <el-row>
                        <h2>{{i18ns.upgradePlan.upgradePlan_selectDevice}}</h2>
                    </el-row>
                    <!-- 组选择 -->
                    <div>
                        <span class="serviceTit"><i></i>{{i18ns.upgradePlan.upgradePlan_groupSelectTip}}</span>
                        <el-button :disabled="deviceData.length===0" v-on:click="clearGroup()">{{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                        <el-button type="primary" @click="add()" :disabled="uplistData.length<=0"
                            v-loading.fullscreen.lock="fullscreenLoading " :element-loading-text="i18ns.common.loading">{{i18ns.common.add}}</el-button>
                    </div>
                    <el-table class="mt20" v-bind:data="deviceData" style="width:100%;" v-loading="loading" key="deviceData"
                        :element-loading-text="i18ns.common.loading" header-row-class-name="my_table_header">
                        <el-table-column prop="Name" :label="i18ns.upgradePlan.upgradePlan_name">
                            <template slot-scope="scope">
                                <el-button type="text" @click="showGroupDetil(scope.row.Name)">{{scope.row.Name}}</el-button>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Description" :label="i18ns.upgradePlan.upgradePlan_groupDescription">
                            <template slot-scope="scope">
                                <span v-if="scope.row.Description!=''">{{i18ns.upgradePlan.upgradePlan_notUsed}}</span>
                                <span v-else>--</span>
                            </template>
                        </el-table-column>
                        <el-table-column :label="i18ns.common.operation">
                            <template slot-scope="scope">
                                <el-button type="text" size="small" v-on:click="handleDelete(scope.row, scope.$index)">{{i18ns.common.delete}}</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="deviceData.length>0">{{i18ns.common.common_totalNumber}}{{deviceData.length}}</p>
                    <!-- 设备选择 -->
                    <div>
                        <span class="serviceTit"><i></i>{{i18ns.upgradePlan.upgradePlan_deviceSelectTitle}}</span>
                        <el-button :disabled="serviceData.length===0" v-on:click="clearService()">{{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                        <el-button type="primary" :disabled="uplistData.length<=0" @click="addService()"
                            v-loading.fullscreen.lock="fullscreenLoading " :element-loading-text="i18ns.common.loading">{{i18ns.common.add}}</el-button>
                    </div>
                    <el-table class="mt20" v-bind:data="serviceData" style="width:100%;" v-loading="loading" key="serviceData"
                        :element-loading-text="i18ns.common.loading" header-row-class-name="my_table_header">
                        <el-table-column prop="" :label="i18ns.upgradePlan.upgradePlan_name">
                            <template slot-scope="scope">
                                <span>--</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="BMCIP" :label="i18ns.upgradePlan.upgradePlan_BMCEMIP"></el-table-column>
                        <el-table-column prop="SerialNumber" :label="i18ns.upgradePlan.upgradePlan_serialNumber"></el-table-column>
                        <el-table-column prop="ProductType" :label="i18ns.upgradePlan.upgradePlan_productType"></el-table-column>
                        <el-table-column prop="Groups" :label="i18ns.upgradePlan.upgradePlan_group">
                            <template slot-scope="scope">
                                <span>{{scope.row.Groups?scope.row.Groups.join(','):'--'}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="AssetTag" :label="i18ns.upgradePlan.upgradePlan_assetLabel"></el-table-column>
                        <el-table-column :label="i18ns.common.operation">
                            <template slot-scope="scope">
                                <el-button type="text" size="small" v-on:click="handleDeleteS(scope.row, scope.$index)">{{i18ns.common.delete}}</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="serviceData.length>0">{{i18ns.common.common_totalNumber}}{{serviceData.length}}</p>
                    <!-- 分批升级 -->
                    <div>
                        <span class="serviceTit"><i></i>{{i18ns.upgradePlan.upgradePlan_importUpgrade}}</span>
                        <el-switch v-model="upgradeSwitch" disabled></el-switch>
                        <span style="color:#999">{{i18ns.upgradePlan.upgradePlan_importUpgradenNoTip}}</span>
                    </div>
                </el-row>
                <!-- 升级策略 -->
                <el-row>
                    <el-row>
                        <h2>{{i18ns.upgradePlan.upgradePlan_upgradePolicy}}</h2>
                    </el-row>
                    <el-form v-bind:model="planForm" ref="planForm" v-bind:label-width="labelWidth" label-position="left"
                        label-suffix=":">
                        <el-form-item :label="i18ns.upgradePlan.upgradePlan_executionPolicy" class="productType">
                            <p>
                                <el-radio v-model="ExecutionPolicy" :label="'Immediate'" :disabled="serviceData.length <= 0&&groupDevices.length<=0">{{i18ns.upgradePlan.upgradePlan_immediateExecution}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_immediateExecutionTip}}</span>
                            </p>
                            <p>
                                <el-radio v-model="ExecutionPolicy" :label="'Period'">{{i18ns.upgradePlan.upgradePlan_cycleCheck}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_cycleCheckTip}}</span>
                            </p>
                            <p>
                                <el-radio v-model="ExecutionPolicy" :label="'SpecifiedTime'" :disabled="serviceData.length <= 0&&groupDevices.length<=0">{{i18ns.upgradePlan.upgradePlan_specifiedTime}}</el-radio>
                                <span v-show="ExecutionPolicy=='SpecifiedTime'">
                                    <el-date-picker v-model="SpecifiedTime" type="datetime" :editable='false'></el-date-picker>
                                </span>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_specifiedTimeTip}}</span>
                            </p>
                        </el-form-item>
                        <el-form-item :label="i18ns.upgradePlan.upgradePlan_effectPolicy" class="productType">
                            <p>
                                <el-radio v-model="EffectPolicy" :label="false">{{i18ns.upgradePlan.upgradePlan_effectiveLater}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_effectiveLaterTip}}</span>
                            </p>
                            <p>
                                <el-radio v-model="EffectPolicy" :label="true">{{i18ns.upgradePlan.upgradePlan_immediateEffect}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_immediateEffectTip}}</span>
                            </p>
                        </el-form-item>
                    </el-form>
                </el-row>

                <!-- 导入基线 -->
                <el-dialog :title="i18ns.upgradePackageWarehouse.versionWarehouse_importExitBaseline" :visible.sync="Baselineisible"
                    width="80%">
                    <el-table v-bind:data="baseLinelistData" border style="width:100%;" v-loading="loading"
                        :element-loading-text="i18ns.common.loading" header-row-class-name="my_table_header"
                        @current-change="handleradioChange">
                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-table :data="props.row.FirmwarePackages" style="width: 100%;" header-row-class-name="my_table_header">
                                    <el-table-column prop="PackageName" :label="i18ns.upgradePackageWarehouse.versionWarehouse_upgradeName"
                                        :show-overflow-tooltip="true"></el-table-column>
                                    <el-table-column prop="SupportModel" :label="i18ns.upgradePackageWarehouse.versionWarehouse_productType"></el-table-column>
                                    <el-table-column prop="Version" :label="i18ns.upgradePackageWarehouse.versionWarehouse_version">
                                        <template slot-scope="scope">
                                            <p v-for="vis in scope.row.Version"><span>{{vis.Module}}：</span>{{vis.CurrentVer}}</p>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="Size" :label="i18ns.upgradePackageWarehouse.versionWarehouse_size">
                                        <template slot-scope="scope">
                                            {{unitFun(scope.row.Size)}}
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </template>
                        </el-table-column>
                        <el-table-column label="" width="70" center>
                            <template slot-scope="scope">
                                <el-radio class="radio" v-model="baselineRadio" :label="scope.row.UUID">&nbsp;</el-radio>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Name" :label="i18ns.upgradePackageWarehouse.versionWarehouse_baselineName"></el-table-column>
                        <el-table-column prop="Status" :label="i18ns.upgradePackageWarehouse.versionWarehouse_usedState"
                            sortable>
                            <template slot-scope="scope">
                                <span v-if="scope.row.Status=='Unused'">{{i18ns.upgradePackageWarehouse.versionWarehouse_notUsed}}</span>
                                <span v-else-if="scope.row.Status=='Using'">{{i18ns.upgradePackageWarehouse.versionWarehouse_using}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Version" :label="i18ns.upgradePackageWarehouse.versionWarehouse_version"></el-table-column>
                    </el-table>
                    <el-row class="pagination-row">
                        <el-col v-bind:span="24" style="text-align:left;">
                            <el-pagination @size-change="pageInfo2HandleSizeChange" @current-change="pageInfo2HandleCurrentChange"
                                v-bind:current-page="pageInfo2.currentPage" v-bind:page-sizes="pageInfo2.pageSizes"
                                v-bind:page-size="pageInfo2.pageSize" layout="total, sizes, prev, pager, next, jumper,slot"
                                v-bind:total="pageInfo2.total">
                                <el-button style="border: 1px solid #c4c4c4;margin-left: 10px;">{{i18ns.common.confirm}}</el-button>
                            </el-pagination>
                        </el-col>
                    </el-row>
                    <div slot="footer" class="dialog-footer">
                        <el-row>
                            <el-col :span="12" style="text-align:left;">
                                <span>{{i18ns.upgradePackageWarehouse.versionWarehouse_alreadyBaseline}}：{{checkedBaseLine1.Name}}</span>
                            </el-col>
                            <el-col :span="12">
                                <el-button @click="Baselineisible=false">{{i18ns.common.cancel}}</el-button>
                                <el-button @click="inportSubmit" v-loading.fullscreen.lock="fullscreenLoading"
                                    :element-loading-text="i18ns.common.loading" :disabled="checkdBaseline.length<=0"
                                    type="primary">{{i18ns.common.confirm}}</el-button>
                            </el-col>
                        </el-row>

                    </div>
                </el-dialog>
                <!-- 添加服务包 -->
                <el-dialog :title="i18ns.upgradePackageWarehouse.versionWarehouse_addUpgradePackage" :visible.sync="UpgradePackageisible"
                    width="80%">
                    <el-row class="packageSearch">
                        <el-col :span="16">
                            <span>{{i18ns.upgradePackageWarehouse.versionWarehouse_firmwareType}}：</span>
                            <el-select v-model="FirmwareType" :placeholder="i18ns.common.pleaseSelect" multiple @change="FirmwareTypeChange"
                                class="el-select-multiple">
                                <el-option v-for="(item,i) in FirmwareTypeOptions" :key="i" :label="item.Module" :value="item.Module">
                                </el-option>
                            </el-select>
                        </el-col>
                        <el-col :span="8" class="input-with-select">
                            <el-input :placeholder="i18ns.OSDeploy.deploy_pleaseInputKeywords" disabled clearable>
                                <el-select v-model="packageValue" slot="prepend" disabled>
                                    <el-option :label="i18ns.upgradePackageWarehouse.versionWarehouse_upgradeName"
                                        value="1"></el-option>
                                </el-select>
                                <el-button slot="append" icon="el-icon-search" disabled></el-button>
                            </el-input>
                        </el-col>
                    </el-row>
                    <el-table ref="addpackage" :data="UpgradePackage" border style="width: 100%;" header-row-class-name="add_table_header"
                        v-loading="addpackageLoading" @selection-change="packageSelectionChange" row-key="UUID">
                        <el-table-column type="selection" width="55" :selectable='checkboxT' :reserve-selection="true">
                        </el-table-column>
                        <el-table-column prop="PackageName" :label="i18ns.upgradePackageWarehouse.versionWarehouse_upgradeName"
                            :show-overflow-tooltip="true"></el-table-column>
                        <el-table-column prop="Type" :label="i18ns.upgradePackageWarehouse.versionWarehouse_type">
                            <template slot-scope="scope">
                                <span v-if="scope.row.Type=='Package_Firmware'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageFirmware}}</span>
                                <span v-else-if="scope.row.Type=='Package_Software'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageSoftware}}</span>
                                <span v-else-if="scope.row.Type=='Bundle_Driver'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageDirve}}</span>
                                <span v-else-if="scope.row.Type=='Bundle_Firmware'">{{i18ns.upgradePackageWarehouse.versionWarehouse_bundleFirmware}}</span>
                                <span v-else-if="scope.row.Type=='Bundle_Software'">{{i18ns.upgradePackageWarehouse.versionWarehouse_bundleSoftware}}</span>
                                <span v-else-if="scope.row.Type=='Board_Firmware'">{{i18ns.upgradePackageWarehouse.versionWarehouse_boardPackage}}</span>
                                <span v-else-if="scope.row.Type=='Package_Driver'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageDirve}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="SupportModel" :label="i18ns.upgradePackageWarehouse.versionWarehouse_productType"></el-table-column>
                        <el-table-column prop="Version" :label="i18ns.upgradePackageWarehouse.versionWarehouse_version">
                            <template slot-scope="scope">
                                <p v-for="vis in scope.row.Version"><span>{{vis.Module}}：</span>{{vis.CurrentVer}}</p>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Size" :label="i18ns.upgradePackageWarehouse.versionWarehouse_size">
                            <template slot-scope="scope">
                                {{unitFun(scope.row.Size)}}
                            </template>
                        </el-table-column>
                        <el-table-column prop="CreationTime" :label="i18ns.upgradePackageWarehouse.versionWarehouse_time"
                            sortable></el-table-column>
                    </el-table>
                    <el-row class="pagination-row">
                        <el-col v-bind:span="24" style="text-align:left;">
                            <el-pagination @size-change="pageInfo1HandleSizeChange" @current-change="pageInfo1HandleCurrentChange"
                                v-bind:current-page="pageInfo1.currentPage" v-bind:page-sizes="pageInfo1.pageSizes"
                                v-bind:page-size="pageInfo1.pageSize" layout="total, sizes, prev, pager, next, jumper,slot"
                                v-bind:total="pageInfo1.total">
                                <el-button style="border: 1px solid #c4c4c4;margin-left: 10px;">{{i18ns.common.confirm}}</el-button>
                            </el-pagination>
                        </el-col>
                    </el-row>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="UpgradePackageisible=false">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="packageSubmit" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary">{{i18ns.common.confirm}}</el-button>
                    </div>
                </el-dialog>
                <!-- 添加时替换升级包 -->
                <el-dialog :title="i18ns.common.prompt" :visible.sync="addPackageDialogisible" width="60%">
                    <el-row>
                        <el-alert :title="i18ns.upgradePackageWarehouse.versionWarehouse_baselinePackageRepeat" type="info"
                            :description="i18ns.upgradePackageWarehouse.versionWarehouse_baselinePackageRepeatTip"
                            show-icon :closable="false">
                        </el-alert>
                    </el-row>
                    <el-table ref="addReplacePackage" :data="messageData" border style="width: 100%; margin-top: 10px;"
                        header-row-class-name="my_table_header" @selection-change="addPackageReplaceChange">
                        <el-table-column type="selection" width="55"> </el-table-column>
                        <el-table-column prop="SupportModel" :label="i18ns.upgradePackageWarehouse.versionWarehouse_productType"></el-table-column>
                        <el-table-column prop="hasVersion" :label="i18ns.upgradePackageWarehouse.versionWarehouse_existingVersion">
                            <template slot-scope="scope">
                                <p v-for="vis in scope.row.hasVersion"><span>{{vis.Module}}：</span>{{vis.CurrentVer}}</p>
                            </template>
                        </el-table-column>
                        <el-table-column prop="replaceVersion" :label="i18ns.upgradePackageWarehouse.versionWarehouse_replaceVersion">
                            <template slot-scope="scope">
                                <p v-for="vis in scope.row.replaceVersion"><span>{{vis.Module}}：</span>{{vis.CurrentVer}}</p>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="addPackageDialogisible=false">{{i18ns.common.no}}</el-button>
                        <el-button @click="addReplacePackageSubmit" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary">{{i18ns.common.yes}}</el-button>
                    </div>
                </el-dialog>
                <!-- 添加 组的弹窗 -->
                <el-dialog :title="i18ns.upgradePlan.upgradePlan_groupAdd" :visible.sync="deviceDialog" width="80%">
                    <el-table ref="nodeTable" :data="deviceList" border style="width: 100%; margin-top: 10px;" key="deviceList"
                        @selection-change="handleSelectDevice">
                        <el-table-column type="selection" width="55" :selectable='checkboxGroupT'></el-table-column>
                        <el-table-column prop="Name" :label="i18ns.upgradePlan.upgradePlan_name"></el-table-column>
                        <el-table-column prop="Description" :label="i18ns.upgradePlan.upgradePlan_descriptionTip">
                            <template slot-scope="scope">
                                <span v-if="scope.row.Description!=''">{{scope.row.Description}}</span>
                                <span v-else>--</span>
                            </template>
                        </el-table-column>
                        <el-table-column :label="i18ns.upgradePlan.upgradePlan_useStatus">
                            <template slot-scope="scope">
                                <!-- <span v-if="checkedDevice.indexOf(scope.row)>-1">{{i18ns.upgradePlan.upgradePlan_usedCurrentPlan}}</span>
                                <span v-else-if="scope.row.Enabled">{{i18ns.upgradePlan.upgradePlan_notUsed}}</span>
                                <span v-else>{{i18ns.upgradePlan.upgradePlan_using}}</span> -->
                                <span>{{scope.row.EnableLabel}}</span>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="deviceDialog=false">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="ensureDevice" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary">{{i18ns.common.confirm}}</el-button>
                    </div>
                </el-dialog>
                <!--添加设备的弹窗 -->
                <el-dialog :title="i18ns.upgradePlan.upgradePlan_addDevicces" :visible.sync="serviceDialog" width="80%">
                    <el-table ref="serviceList" :data="serviceList" border style="width: 100%; margin-top: 10px;" key="serviceList"
                        :header-row-class-name="serviceList.length>0?'':'device_table_header'" @selection-change="handleSelectS">
                        <el-table-column type="selection" width="55"></el-table-column>
                        <el-table-column prop="" :label="i18ns.upgradePlan.upgradePlan_name">
                            <template slot-scope="scope">
                                <span>--</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="BMCIP" :label="i18ns.upgradePlan.upgradePlan_BMCEMIP"></el-table-column>
                        <el-table-column prop="SerialNumber" :label="i18ns.upgradePlan.upgradePlan_serialNumber"></el-table-column>
                        <el-table-column prop="ProductType" :label="i18ns.upgradePlan.upgradePlan_productType"></el-table-column>
                        <!--  <el-table-column prop="Groups" :label="i18ns.upgradePlan.upgradePlan_group"></el-table-column>
                        <el-table-column prop="AssetTag" :label="i18ns.upgradePlan.upgradePlan_assetLabel"></el-table-column> -->
                        <el-table-column prop="Groups" :label="i18ns.upgradePlan.upgradePlan_group">
                            <template slot-scope="scope">
                                <span>{{scope.row.Groups?scope.row.Groups.join(','):'--'}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="AssetTag" :label="i18ns.upgradePlan.upgradePlan_assetLabel">
                            <template slot-scope="scope">
                                <span>{{scope.row.AssetTag?scope.row.AssetTag:'--'}}</span>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="serviceList.length>0">{{i18ns.common.common_totalNumber}}{{serviceList.length}}</p>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="serviceDialog=false">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="ensureService" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary">{{i18ns.common.confirm}}</el-button>
                    </div>
                </el-dialog>
                <!-- 设备组的单个详情 -->
                <el-dialog :title="groupItemTit" :visible.sync="groupDialog" width="80%">
                    <el-row>
                        <p><i class="el-icon-info" style="color:#409eff;font-style:normal;"></i>{{i18ns.upgradePlan.upgradePlan_filterDevice}}</p>
                    </el-row>
                    <el-table :data="groupItem" border style="width: 100%; margin-top: 10px;" header-row-class-name="my_table_header">
                        <el-table-column prop="IPv4Address.Address" :label="i18ns.upgradePlan.upgradePlan_BMCIP"></el-table-column>
                        <el-table-column prop="SerialNumber" :label="i18ns.upgradePlan.upgradePlan_serialNumber"></el-table-column>
                        <el-table-column prop="Model" :label="i18ns.upgradePlan.upgradePlan_productType"></el-table-column>
                        <el-table-column prop="Group" :label="i18ns.upgradePlan.upgradePlan_executeType">
                            <template slot-scope="scope">
                                <span>{{scope.row.Group?scope.row.Group.join(','):'--'}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Tag" :label="i18ns.upgradePlan.upgradePlan_label"></el-table-column>
                    </el-table>
                </el-dialog>
            </div>
        </el-row>
        <el-row>
            <!-- 底部按钮 -->
            <el-button style="margin-top:10px;" @click="back">{{i18ns.common.cancel}}</el-button>
            <el-button style="margin-top:10px;" @click="submitPlan" :disabled="uplistData.length<=0||(serviceData.length <= 0&&groupDevices.length<=0&&deviceData.length<=0)">{{i18ns.common.submit}}</el-button>
        </el-row>
    </div>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                editLoading: true,
                labelWidth: '250px',
                i18ns: [],
                FDIp: '',
                FDList: [],
                loading: false,
                fullscreenLoading: false,

                upgradeForm: {
                    PlanName: '',
                    Description: '',
                    selectMethod: 'Baseline',
                },
                rules: {
                    PlanName: {
                        required: true,
                        validator: function (rule, value, callback) {
                            if (value) {
                                if (!/^[a-zA-Z0-9_\-.\u4e00-\u9fa5]+$/.test(value) || value.length >
                                    32) {
                                    return callback(new Error(app.i18ns.common.regExp_userName));
                                } else
                                    return callback();
                            } else {
                                return callback(new Error(app.i18ns.upgradePackageWarehouse.configInfo_inputNotNull));
                            }
                        },
                        trigger: 'blur'
                    },
                    Description: {
                        required: false,
                        validator: function (rule, value, callback) {
                            if (value) {
                                if (value.length > 256) {
                                    return callback(new Error(app.i18ns.OSDeploy.deploy_descriptionLimit));
                                } else
                                    return callback();
                            } else {
                                return callback();
                            }
                        },
                        trigger: 'change'
                    },
                },
                //选择版本
                isPlanName: false, //名称是否重复
                uplistData: [],
                pageInfo1: {
                    currentPage: 1,
                    pageSizes: [10, 20, 50, 100],
                    pageSize: 10,
                    total: 0,
                },
                pageInfo2: {
                    currentPage: 1,
                    pageSizes: [10, 20, 50, 100],
                    pageSize: 10,
                    total: 0,
                },
                baseLinelistData: [],
                allBaseLinelist: [], //存放从接口返回的全部基线（不分页查询）
                Baselineisible: false,
                baselineRadio: '',
                checkdBaseline: '', //选择的基线
                checkedBaseLine1: [],
                //导入已有基线
                UpgradePackageisible: false,
                allUpgradePackageList: [], //存放从接口返回的全部升级包（不分页查询）
                UpgradePackage: [],
                checkedBaseId: '',
                firmwarePackages: '',
                //添加服务包
                ProductType: '',
                ProductTypes: [],
                FirmwareType: [],
                FirmwareTypeOptions: [],
                checkedPackage: [],
                addpackageRadio: '',
                addpackageLoading: false,
                packageValue: '1',
                oldAllPackageList: [],
                //替换
                replaceisible: false,
                oldPackage: [],
                replacePackage: [],
                packageRadio: '',
                checkedReplacePackage: '',

                // 添加升级包时的替换
                messageCheckedList: '',
                messageChecked: [],
                messageData: [],
                addPackageDialogisible: false,
                hasData: '',
                replaceType: 'baseline',
                // 设备信息
                //组选择
                deviceData: [],
                deviceDialog: false,
                isCheckAll: true, //是否选中所有设备行
                deviceList: [],
                checkedDevice: [],
                checkedDeviceNum: 0,
                isBackFlag: false, //隐藏高版本
                deviceNum: 0,
                isCheckGroup: [],
                groupDevices: [],
                EnableLabel: '',
                //设备选择
                serviceData: [],
                serviceDialog: false,
                serviceList: [],
                checkedService: [],
                serviceNum: 0,
                checkedServiceNum: 0,
                //分批升级
                upgradeSwitch: false,

                // 升级策略
                planForm: {},
                ExecutionPolicy: 'Immediate',
                EffectPolicy: false,
                SpecifiedTime: '', //

                ID: '',
                oldTime: '',
                // 设备组的详情
                groupDialog: false,
                groupItemTit: '',
                groupItem: [],

                isCheckgroup: false,

                oldDeviceGroupData: []
            },
            computed: {
                updalodUrl: function () {
                    return com_huawei_fdvcenterpluginui.webContextPath + '/rest/services/fd/upload?ips=' +
                        this.FDIp +
                        '&httpMethod=POST&endpoint=/rich/UpgradeService/Actions/Package.Import';
                }
            },
            created: function () {
                this.i18ns = getIn18();
                this.ID = getQueryString('id');
                this.editLoading = true;
            },
            mounted: function () {
                var that = this;
                //获取FD列表数据
                setTimeout(function () {
                    getFDList(that.bindFD);
                }, 0);
            },
            methods: {
                unitFun: function (Size) {
                    return unitFun(Size)
                },
                /**
                 * 获取FD数据 回调函数
                 * @param {any} ret 
                 */
                bindFD: function (ret) {
                    if (ret.code === '0') {
                        var lg = ret.data.length;
                        if (lg > 0) {
                            var data = ret.data;
                            for (var i = 0; i < data.length; i++) {
                                this.FDList.push({
                                    label: data[i].aliasName || data[i].hostIp,
                                    value: data[i].hostIp
                                });
                            }
                            var currentFD = getCurrentFD();
                            if (currentFD) {
                                var _currentFD = _.find(this.FDList, {
                                    value: currentFD
                                })
                                if (_currentFD) {
                                    this.FDIp = currentFD;
                                } else {
                                    setCurrentFD(ret.data[0].hostIp);
                                    this.FDIp = ret.data[0].hostIp;
                                }
                            } else {
                                setCurrentFD(ret.data[0].hostIp);
                                this.FDIp = ret.data[0].hostIp;
                            }
                        } else {
                            alertMsg(getErrorMsg({
                                code: '-90002'
                            }))
                        }
                        this.getGroupList()
                    } else {
                        var msg = getErrorMsg(ret);
                        alertMsg(msg);
                    }
                },
                /**
                 * FD下拉框 点击切换事件
                 * 
                 * @param {any} command 
                 * @param {any} com 
                 */
                commandClick: function () {
                    setCurrentFD(this.FDIp);
                    this.uplistData = []
                    this.serviceData = []
                },
                /**
                 * 获取单个的详情
                 */
                getItemDetail: function () {
                    upgradePackageManage.getUpgradePlanById({
                        ip: this.FDIp,
                        id: this.ID
                    }, function (ret) {
                        app.editLoading = false;
                        if (ret.code == '0') {
                            var obj = ret.data[0].data;
                            app.upgradeForm = {
                                PlanName: obj.Name,
                                Description: obj.Description,
                                selectMethod: obj.VersionType
                            };
                            if (obj.VersionType == 'Baseline') {
                                app.uplistData = obj.BaselineInfo.FirmwarePackages;
                                app.checkedBaseId = obj.BaselineInfo.UUID;
                            }
                            if (obj.VersionType == 'UpgradePackage') {
                                app.uplistData = obj.Packages;
                                _.each(app.uplistData, function (item) {
                                    item.SupportModel = item.ProductType;
                                    item.UUID = item.ID;
                                })
                            }
                            if (obj.TaskFlow) {
                                app.serviceData = obj.TaskFlow[0].Devices ? obj.TaskFlow[0].Devices :
                                    [];
                            }
                            app.ExecutionPolicy = obj.ExecutionPolicy;
                            app.EffectPolicy = obj.ResetImmediately;
                            if (obj.ExecutionPolicy != 'SpecifiedTime') {
                                app.SpecifiedTime = new Date(sessionStorage.getItem('serverDate').replace(
                                    /-/g, "/"));
                            } else {
                                var time = obj.SpecifiedTime;
                                time = time.replace(/[T,Z]/g, " ");
                                this.oldTime = time;
                                app.SpecifiedTime = new Date(time.replace(
                                    /-/g, "/"));
                            }
                            _.each(obj.DeviceGroupIDs, function (item) {
                                _.each(app.deviceList, function (device) {
                                    if (item == device.ID) {
                                        app.deviceData.push(device);
                                    }
                                })
                            })
                            app.deviceData = _.union(app.deviceData);
                            app.oldDeviceGroupData = _.union(app.deviceData);
                            if (app.deviceData.length > 0) {
                                app.groupDevice()
                            }
                        } else {
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    });
                },

                /**
                 * 切换版本类型
                 */
                switchType: function () {
                    this.uplistData = [];
                    this.serviceData = []
                    app.checkedBaseId = '';
                },
                /**
                 * 自定义基线
                 */
                toCreatBaseline: function () {
                    window.location.href = '../upgradePackageWarehouse/createBaseline.html';
                },
                /**
                 * 上传升级包
                 */
                toUpPackage: function () {
                    window.location.href = "../upgradePackageWarehouse/index.html?type=" + 'second';
                },

                /**
                 * 添加已有基线
                 */
                checkBaseline: function () {
                    this.Baselineisible = true;
                    this.replaceType = 'baseline';
                    this.getBaselineData()
                },

                /**
                 * 获取已有基线列表
                 */
                getBaselineData: function () {
                    this.baseLinelistData = [];
                    this.allBaseLinelist = [];
                    this.loading = true;
                    upgradePackageManage.getAllBaselineList({
                        ip: this.FDIp,
                    }, function (ret) {
                        app.loading = false;
                        if (ret.code == '0') {
                            //app.baseLinelistData = ret.data[0].data.Members;
                            app.baselineRadio = app.checkedBaseId;
                            app.allBaseLinelist = ret.data[0].data.Members;
                            var index = _.findIndex(app.allBaseLinelist, function (x) {
                                return x.UUID == app.baselineRadio;
                            });
                            if (index < 0) {
                                index = 0;
                            }
                            if (app.allBaseLinelist.length > 0) {
                                app.checkedBaseLine1 = app.allBaseLinelist[index];
                                app.checkdBaseline = app.allBaseLinelist[index].FirmwarePackages;
                                app.checkedBaseId = app.allBaseLinelist[index].UUID;
                            }
                            app.baselineRadio = app.checkedBaseId;
                            /*  _.each(app.allBaseLinelist, function (item, index) {
                                 if (item.UUID == app.checkedBaseId) {
                                     app.baselineRadio = index;
                                 }
                             })
                             app.checkdBaseline = app.baseLinelistData[app.baselineRadio].FirmwarePackages;
                             app.checkedBaseId = app.baseLinelistData[app.baselineRadio].UUID; */
                            app.pageInfo2.total = app.allBaseLinelist.length;
                            if (app.pageInfo2.total > 0) {
                                app.baseLinelistData = app.allBaseLinelist.slice(0, app.pageInfo2
                                    .pageSize);
                            }
                        } else {
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    });
                },

                /**
                 * 添加升级包
                 */
                addUpgradePackage: function () {
                    this.addpackageRadio = "";
                    this.FirmwareType = []
                    this.UpgradePackageisible = true;
                    Vue.nextTick(function () {
                        app.$refs.addpackage.clearSelection()
                    })
                    this.replaceType = 'package';
                    this.pageInfo1.currentPage = 1;
                    this.pageInfo1.pageSize = 10;
                    this.getPackageList()
                },
                /**
                 * 获取升级包列表
                 */
                getPackageList: function () {
                    this.UpgradePackage = [];
                    this.allUpgradePackageList = [];
                    this.addpackageLoading = true;
                    upgradePackageManage.getAllPackageList({
                        ip: this.FDIp,
                    }, function (ret) {
                        app.addpackageLoading = false;
                        if (ret.code == '0') {
                            var data = ret.data[0].data.Members,
                                arr = [];
                            app.FirmwareTypeOptions = []
                            var result = [];
                            for (var i = 0; i < data.length; i++) {
                                var obj = {
                                    SupportModel: data[i].ProductType,
                                    Version: []
                                }
                                for (var j = 0; j < data[i].Version.length; j++) {
                                    var verObj = {
                                        CurrentVer: data[i].Version[j].CurrentVer,
                                        Module: data[i].Version[j].Module
                                    }
                                    obj.Version.push(verObj)
                                    var model = {
                                        label: data[i].Version[j].Module,
                                        Module: data[i].Version[j].Module
                                    }
                                    var isP = _.some(app.FirmwareTypeOptions, function (item) {
                                        return item.Module == model.Module
                                    })
                                    if (!isP) {
                                        app.FirmwareTypeOptions.push(model);
                                    }
                                }
                                arr.push(obj)
                                data[i].SupportModel = arr[i].SupportModel;
                                data[i].Version = arr[i].Version;
                                data[i].Status = "Free";
                                var isExist = false;
                                for (var k = 0; k < app.uplistData.length; k++) {
                                    if (data[i].PackageName == app.uplistData[k].PackageName) {
                                        isExist = true;
                                        break;
                                    }
                                }
                                if (!isExist) {
                                    result.push(data[i]);
                                }
                            }
                            /* if (app.uplistData.length > 0) {
                                app.UpgradePackage = result;
                            } else {
                                app.UpgradePackage = data;
                            } */
                            if (app.uplistData.length > 0) {
                                app.allUpgradePackageList = result;
                                app.oldAllPackageList = result;
                            } else {
                                app.allUpgradePackageList = data;
                                app.oldAllPackageList = data;
                            }
                            app.pageInfo1.total = app.allUpgradePackageList.length;
                            if (app.pageInfo1.total > 0) {
                                app.UpgradePackage = app.allUpgradePackageList.slice(0, app.pageInfo1
                                    .pageSize);
                            }
                        } else {
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    });
                },

                /**
                 * 升级包类型
                 */
                ProductTypeChange: function (val) {},
                FirmwareTypeChange: function (val) {
                    if (val.length <= 0) {
                        this.allUpgradePackageList = this.oldAllPackageList;
                        app.pageInfo1.total = app.allUpgradePackageList.length;
                        if (app.pageInfo1.total > 0) {
                            app.UpgradePackage = app.allUpgradePackageList.slice(0, app.pageInfo1
                                .pageSize);
                        }
                        return false
                    }
                    var arr = [];
                    _.each(this.oldAllPackageList, function (item) {
                        if (_.some(item.Version, function (ver) {
                                return val.indexOf(ver.Module) > -1
                            })) {
                            arr.push(item)
                        }
                    })
                    this.allUpgradePackageList = arr;
                    app.pageInfo1.total = app.allUpgradePackageList.length;
                    if (app.pageInfo1.total > 0) {
                        app.UpgradePackage = app.allUpgradePackageList.slice(0, app.pageInfo1
                            .pageSize);
                    }
                },

                /**
                 * 禁用升级包的复选框
                 */
                checkboxT: function (row, index) {
                    if (row.Status !== "Busy") {
                        return 1;
                    } else {
                        return 0;
                    }
                },
                /**
                 * 选择升级包
                 */
                packageSelectionChange: function (val) {
                    this.checkedPackage = val;
                    this.isCheck()
                },
                isCheck: function () {
                    var checkedList = [],
                        data = this.allUpgradePackageList;
                    if (this.checkedPackage.length > 0) {
                        _.each(this.checkedPackage, function (item) {
                            checkedList.push(item.UUID);
                        })
                        _.each(checkedList, function (elementCheck) {
                            _.each(data, function (element) {
                                var versions = [];
                                _.each(element.Version, function (elementVersion) {
                                    versions.push(elementVersion.Module)
                                });
                                if (element.ProductType.indexOf("CH121 V5") === -1 &&
                                    element.ProductType.indexOf("CH121L V5") === -1 &&
                                    element.ProductType.indexOf("CH221 V5") === -1 &&
                                    element.ProductType.indexOf("CH225 V5") === -1 &&
                                    element.ProductType.indexOf("CH242 V5") === -1 &&
                                    element.ProductType.indexOf("CX320") === -1 &&
                                    element.ProductType.indexOf("CH242 V5") === -1 &&
                                    element.ProductType.indexOf("CX916") === -1 &&
                                    element.ProductType.indexOf("CX916L") === -1 && element
                                    .ProductType.indexOf("CX710") === -1 &&
                                    element.ProductType.indexOf("CX920") === -1 && element.ProductType
                                    .indexOf("MM920") === -1 &&
                                    element.ProductType.indexOf("MM920_MSMB") === -1) {
                                    if (elementCheck === element.UUID && (element.Type ===
                                            "Package_Software" || element.Type ===
                                            "Package_Firmware")) {
                                        _.each(data, function (elementModule) {
                                            if (elementModule.ProductType.indexOf(
                                                    "CH121 V5") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CH121L V5") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CH221 V5") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CH225 V5") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CH242 V5") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CX320") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CH242 V5") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CX916") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CX916L") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CX710") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "CX920") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "MM920") === -1 &&
                                                elementModule.ProductType.indexOf(
                                                    "MM920_MSMB") === -1) {
                                                if (element.ProductType ===
                                                    elementModule.ProductType &&
                                                    element.Version[0].Module ===
                                                    elementModule.Version[0].Module
                                                ) {
                                                    if (element.UUID !==
                                                        elementModule.UUID) {
                                                        elementModule.Status =
                                                            "Busy"
                                                    }
                                                }
                                            }

                                        })
                                    }
                                } else {
                                    if (elementCheck === element.UUID && element.Type ===
                                        "Board_Firmware") {
                                        _.each(data, function (elementModule) {
                                            if (!(elementModule.ProductType.indexOf(
                                                        "CH121 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH121L V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH221 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH225 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH242 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX320") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH242 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX916") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX916L") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX710") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX920") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "MM920") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "MM920_MSMB") === -1)) {
                                                if (element.ProductType ===
                                                    elementModule.ProductType) {
                                                    if (element.UUID !==
                                                        elementModule.UUID) {
                                                        elementModule.Status =
                                                            "Busy"
                                                    }
                                                }
                                            }

                                        })
                                    }
                                    if (elementCheck === element.UUID && element.Type !==
                                        "Board_Firmware") {
                                        _.each(data, function (elementModule) {
                                            if (!(elementModule.ProductType.indexOf(
                                                        "CH121 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH121L V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH221 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH225 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH242 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX320") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CH242 V5") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX916") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX916L") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX710") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "CX920") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "MM920") === -1 &&
                                                    elementModule.ProductType.indexOf(
                                                        "MM920_MSMB") === -1)) {
                                                if ((element.ProductType ===
                                                        elementModule.ProductType &&
                                                        element.Version[0].Module ===
                                                        elementModule.Version[0].Module
                                                    ) ||
                                                    (element.ProductType ===
                                                        elementModule.ProductType &&
                                                        elementModule.Type ===
                                                        "Board_Firmware")) {
                                                    if (element.UUID !==
                                                        elementModule.UUID) {
                                                        elementModule.Status =
                                                            "Busy"
                                                    }
                                                }
                                            }

                                        })
                                    }
                                }
                            });
                            _.each(data, function (element) {
                                if (element.Status === "Busy") {
                                    if (element.ProductType.indexOf("CH121 V5") === -1 &&
                                        element.ProductType.indexOf("CH121L V5") === -1 &&
                                        element.ProductType.indexOf("CH221 V5") === -1 &&
                                        element.ProductType.indexOf("CH225 V5") === -1 &&
                                        element.ProductType.indexOf("CH242 V5") === -1 &&
                                        element.ProductType.indexOf("CX320") === -1 &&
                                        element.ProductType.indexOf("CH242 V5") === -1 &&
                                        element.ProductType.indexOf("CX916") === -1 &&
                                        element.ProductType.indexOf("CX916L") === -1 &&
                                        element.ProductType.indexOf("CX710") === -1 &&
                                        element.ProductType.indexOf("CX920") === -1 &&
                                        element.ProductType.indexOf("MM920") === -1 &&
                                        element.ProductType.indexOf("MM920_MSMB") === -1) {
                                        _.each(data, function (ele) {
                                            if (ele.ProductType.indexOf("CH121 V5") ===
                                                -1 && ele.ProductType.indexOf(
                                                    "CH121L V5") === -1 &&
                                                ele.ProductType.indexOf("CH221 V5") ===
                                                -1 && ele.ProductType.indexOf(
                                                    "CH225 V5") === -1 &&
                                                ele.ProductType.indexOf("CH242 V5") ===
                                                -1 && ele.ProductType.indexOf(
                                                    "CX320") === -1 &&
                                                ele.ProductType.indexOf("CH242 V5") ===
                                                -1 && ele.ProductType.indexOf(
                                                    "CX916") === -1 &&
                                                ele.ProductType.indexOf("CX916L") ===
                                                -1 && ele.ProductType.indexOf(
                                                    "CX710") === -1 &&
                                                ele.ProductType.indexOf("CX920") ===
                                                -1 && ele.ProductType.indexOf(
                                                    "MM920") === -1 &&
                                                ele.ProductType.indexOf(
                                                    "MM920_MSMB") === -1) {
                                                if ((element.UUID !== ele.UUID &&
                                                        element.ProductType === ele
                                                        .ProductType && element.Version[
                                                            0].Module === ele.Version[
                                                            0].Module &&
                                                        !_.some(checkedList,
                                                            function (item) {
                                                                return item == ele.UUID
                                                            }) && ele.Status ===
                                                        "Free" && element.Type !==
                                                        "Board_Firmware")) {
                                                    element.Status = "Free"
                                                }
                                            }
                                        })
                                    } else {
                                        _.each(data, function (ele) {
                                            if (!(ele.ProductType.indexOf(
                                                        "CH121 V5") === -1 && ele.ProductType
                                                    .indexOf("CH121L V5") === -1 &&
                                                    ele.ProductType.indexOf(
                                                        "CH221 V5") === -1 && ele.ProductType
                                                    .indexOf("CH225 V5") === -1 &&
                                                    ele.ProductType.indexOf(
                                                        "CH242 V5") === -1 && ele.ProductType
                                                    .indexOf("CX320") === -1 &&
                                                    ele.ProductType.indexOf(
                                                        "CH242 V5") === -1 && ele.ProductType
                                                    .indexOf("CX916") === -1 &&
                                                    ele.ProductType.indexOf(
                                                        "CX916L") === -1 && ele.ProductType
                                                    .indexOf("CX710") === -1 &&
                                                    ele.ProductType.indexOf("CX920") ===
                                                    -1 && ele.ProductType.indexOf(
                                                        "MM920") === -1 &&
                                                    ele.ProductType.indexOf(
                                                        "MM920_MSMB") === -1)) {
                                                if ((element.UUID !== ele.UUID &&
                                                        element.ProductType === ele
                                                        .ProductType && !_.some(
                                                            checkedList,
                                                            function (item) {
                                                                return item == ele.UUID
                                                            }) && ele.Status ===
                                                        "Free" && (element.Type ===
                                                            "Board_Firmware")) || (
                                                        element.UUID !== ele.UUID &&
                                                        element.ProductType === ele
                                                        .ProductType && element.Version[
                                                            0].Module === ele.Version[
                                                            0].Module && !_.some(
                                                            checkedList,
                                                            function (item) {
                                                                return item == ele.UUID
                                                            }) && ele.Status ===
                                                        "Free" && element.Type !==
                                                        "Board_Firmware")) {
                                                    element.Status = "Free"
                                                }
                                            }

                                        })

                                    }
                                }


                            });
                        })
                    } else {
                        _.each(data, function (elementModule) {
                            elementModule.Status = "Free"
                        });
                    }
                },

                /**
                 * 删除全部
                 */
                deleteAll: function () {
                    this.uplistData = []
                    // this.deviceData = []
                    // this.isCheckGroup = []
                    this.serviceData = [];
                },

                /**
                 * 基线的单选
                 */
                handleradioChange: function (val) {
                    this.checkedBaseLine1 = val;
                    if (val) {
                        this.checkdBaseline = val.FirmwarePackages;
                        this.checkedBaseId = val.UUID;
                        this.baselineRadio = val.UUID;
                    }
                },

                /**
                 * 确定导入已有基线
                 */
                inportSubmit: function () {
                    this.uplistData = this.checkdBaseline;
                    this.serviceData = []
                    this.Baselineisible = false;
                },
                /**
                 * 确定添加服务包
                 */
                packageSubmit: function () {
                    var hasData = [],
                        messageData = [];
                    var checkedList = [],
                        datas = this.uplistData,
                        allDatabackup = JSON.parse(JSON.stringify(this.allUpgradePackageList));
                    _.each(this.checkedPackage, function (item) {
                        checkedList.push(item.UUID);
                    })
                    _.each(checkedList, function (id) {
                        _.each(datas, function (data) {
                            var packagesObj = _.filter(allDatabackup, function (item) {
                                return item.UUID == id && item.SupportModel == data
                                    .SupportModel
                            })[0];
                            if (packagesObj && data.Version.length === 1 && packagesObj.PackageName !==
                                data.PackageName) {
                                if (packagesObj.Version.length === 1) {
                                    if (data.Version[0].Module === packagesObj.Version[0].Module) {
                                        hasData.push(packagesObj);
                                        messageData.push({
                                            UUID: packagesObj.UUID,
                                            SupportModel: packagesObj.SupportModel,
                                            hasVersion: data.Version,
                                            replaceVersion: packagesObj.Version
                                        });
                                    }
                                } else {
                                    hasData.push(packagesObj);
                                    messageData.push({
                                        UUID: packagesObj.UUID,
                                        SupportModel: packagesObj.SupportModel,
                                        hasVersion: data.Version,
                                        replaceVersion: packagesObj.Version
                                    });
                                }
                            } else if (packagesObj && packagesObj.PackageName !== data.PackageName) {
                                hasData.push(packagesObj);
                                messageData.push({
                                    UUID: packagesObj.UUID,
                                    SupportModel: packagesObj.SupportModel,
                                    hasVersion: data.Version,
                                    replaceVersion: packagesObj.Version
                                });
                            }
                        })
                    });
                    hasData = _.uniq(hasData);

                    if (hasData.length === 0) {
                        _.each(checkedList, function (id) {
                            var messageDataObj = _.filter(allDatabackup, function (item) {
                                return item.UUID == id
                            })[0];
                            var scopeHasPackage = _.filter(datas, function (item) {
                                return item.PackageName == messageDataObj.PackageName &&
                                    item.SupportModel == messageDataObj.SupportModel
                            })[0];
                            if (!!messageDataObj && !scopeHasPackage) {
                                messageDataObj.SupportModel = messageDataObj.SupportModel;
                                datas.push(messageDataObj)
                            }
                        });
                        this.UpgradePackageisible = false;
                    } else {
                        app.addPackageDialogisible = true;
                        app.messageData = messageData;
                        var messageCheckedList = [];
                        app.messageChecked = [];
                        Vue.nextTick(function () {
                            _.each(messageData, function (item) {
                                messageCheckedList.push(item.UUID);
                                app.$refs.addReplacePackage.toggleRowSelection(item, true);
                            })
                        })
                        this.messageCheckedList = messageCheckedList;
                        this.hasData = hasData;
                    }
                    app.baselineRadio = '';
                },
                /**
                 * 添加升级包时的 替换的选择
                 */
                addPackageReplaceChange: function (val) {
                    this.messageChecked = val;
                },
                /**
                 * 添加升级包时的 替换
                 */
                addReplacePackageSubmit: function () {
                    var deletePackagesArr = [];
                    var datas = this.uplistData,
                        allDatabackup = JSON.parse(JSON.stringify(this.UpgradePackage)),
                        hasData = this.hasData;
                    _.each(this.messageCheckedList, function (id) {
                        var hasObj = _.filter(hasData, function (item) {
                            return item.UUID == id
                        })[0];
                        _.each(datas, function (data) {
                            if (hasObj.Version.length === 1) {
                                if (data.Version.length === 1) {
                                    if (data.Version[0].Module === hasObj.Version[
                                            0].Module && data.SupportModel ===
                                        hasObj.SupportModel) {
                                        deletePackagesArr.push(data);
                                    }
                                } else if (data.SupportModel === hasObj.SupportModel) {
                                    deletePackagesArr.push(data);
                                }
                            } else if (data.SupportModel === hasObj.SupportModel) {
                                deletePackagesArr.push(data);
                            }
                        });
                    });
                    _.each(deletePackagesArr, function (deleteObj) {
                        datas = _.without(datas, _.filter(datas, function (item) {
                            return item.PackageName == deleteObj.PackageName && item.SupportModel ==
                                deleteObj.SupportModel
                        })[0]);
                    });
                    _.each(hasData, function (data) {
                        if (app.messageCheckedList.indexOf(data.UUID) === -1) {
                            app.messageCheckedList = _.without(app.messageCheckedList, data.UUID);
                        }
                    });
                    _.each(app.messageCheckedList, function (id) {
                        var messageDataObj = _.filter(allDatabackup, function (item) {
                            return item.UUID == id
                        })[0];
                        var scopeHasPackage = _.filter(datas, function (item) {
                            return item.PackageName == messageDataObj.PackageName && item.SupportModel ==
                                messageDataObj.SupportModel
                        })[0];
                        if (!!messageDataObj && !scopeHasPackage) {
                            messageDataObj.SupportModel = messageDataObj.SupportModel;
                            datas.push(messageDataObj)
                        }
                    });
                    console.log(datas)
                    this.uplistData = datas;
                    this.serviceData = []
                    app.addPackageDialogisible = false;
                    this.UpgradePackageisible = false;
                },
                /**
                 * 删除单个基线版本信息
                 */
                deleteOne: function (row, index) {
                    this.uplistData.splice(index, 1)
                    if (this.uplistData.length == 0) {
                        this.baselineRadio = '';
                        // this.deviceData = []
                        // this.isCheckGroup = []
                        this.serviceData = [];
                    }
                },


                /**
                 * 清空组选择
                 */
                clearGroup: function () {
                    this.deviceData = []
                },
                /**
                 * 添加组选择
                 */
                add: function () {
                    this.deviceDialog = true;
                    this.getGroupsList()
                },
                /**
                 * 组弹窗的选择事件
                 */
                handleSelectDevice: function (val) {
                    this.checkedDevice = val;
                    this.checkedDeviceNum = val.length;
                },
                /**
                 * 确定添加组
                 */
                ensureDevice: function () {
                    this.deviceDialog = false;
                    this.deviceData = this.checkedDevice;
                    if (this.checkedDevice.length > 0) {
                        this.groupDevice()
                    }
                },
                /**
                 * 所选组 所包含的设备
                 */
                groupDevice: function () {
                    var queryParam = {
                        BaselineInfo: {},
                        Filter: {
                            GroupIDs: [],
                            ProductTypes: [],
                            BMCIP: "",
                            Skip: 0,
                            Top: 0
                        },
                        PackageInfos: [],
                        VersionType: ""
                    }
                    if (this.deviceData.length > 0) {
                        _.each(this.deviceData, function (item) {
                            queryParam.Filter.GroupIDs.push(item.ID + "")
                        })
                    }
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        queryParam.VersionType = 'Baseline';
                        queryParam.BaselineInfo.BaselineID = this.checkedBaseId;
                        var arr = []
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageName: this.uplistData[i].PackageName,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            arr.push(obj)
                        }
                        queryParam.BaselineInfo.FirmwarePackages = arr;
                    } else {
                        queryParam.VersionType = 'UpgradePackage';
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageID: this.uplistData[i].UUID,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            queryParam.PackageInfos.push(obj)
                        }
                    }
                    upgradePackageManage.groupDevice({
                        ip: this.FDIp,
                        data: queryParam
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.groupDevices = ret.data[0].data.Devices ? ret.data[0].data.Devices :
                                []
                        } else {
                            var msg = getErrorMsg(ret);
                            this.alertMsg(msg);
                        }
                    })
                },
                /**
                 * 删除已选组
                 */
                handleDelete: function (row, index) {
                    this.deviceData.splice(index, 1);
                    if (this.serviceData.length <= 0 && this.groupDevices.length <= 0) {
                        this.ExecutionPolicy = "Period";
                        console.log('11111')
                    }
                    console.log(this.ExecutionPolicy)
                },
                /**
                 * 获取组的列表
                 */
                getGroupList: function () {
                    upgradePackageManage.getAllGRoupList({
                        ip: this.FDIp
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.deviceList = ret.data[0].data.Groups ? ret.data[0].data.Groups : [];
                            app.deviceNum = ret.data[0].data['Members@odata.count'];
                            if (app.deviceList.length > 0 || (ret.data[0].data.Groups != null &&
                                    ret.data[0].data.Groups.length > 0)) {
                                app.checkGroup();
                                app.getItemDetail()
                            } else {
                                app.isCheckgroup = false;
                            }
                        } else {
                            var msg = getErrorMsg(ret);
                            this.alertMsg(msg);
                        }
                    })
                },
                /**
                 * 获取组的列表
                 */
                getGroupsList: function () {
                    upgradePackageManage.getAllGRoupList({
                        ip: this.FDIp
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.deviceList = ret.data[0].data.Groups ? ret.data[0].data.Groups : [];
                            app.deviceNum = ret.data[0].data['Members@odata.count'];
                            for (var i = 0; i < app.deviceList.length; i++) {
                                if (_.some(app.deviceData, function (item) {
                                        return item.ID == app.deviceList[i].ID;
                                    })) {
                                    (function (arg) {
                                        Vue.nextTick(function () {
                                            app.$refs.nodeTable.toggleRowSelection(arg,
                                                true);
                                        })
                                    })(app.deviceList[i])
                                }
                            }
                            if (app.deviceList.length > 0 || (ret.data[0].data.Groups != null &&
                                    ret.data[0].data.Groups.length > 0)) {
                                app.checkGroup();
                            } else {
                                app.isCheckgroup = false;
                            }
                        } else {
                            var msg = getErrorMsg(ret);
                            this.alertMsg(msg);
                        }
                    })
                },
                /**
                 * 检查组的可用
                 */
                checkGroup: function () {
                    var queryParam = {
                        GroupIDs: []
                    };
                    _.each(this.deviceList, function (item) {
                        queryParam.GroupIDs.push(item.ID + "")
                    })
                    if (queryParam.GroupIDs.length > 0) {
                        upgradePackageManage.checkGeoup({
                            ip: this.FDIp,
                            data: queryParam
                        }, function (ret) {
                            if (ret.code == '0') {
                                app.isCheckGroup = ret.data[0].data.EnableGroupIDs ? ret.data[0].data
                                    .EnableGroupIDs : [];
                                if (app.isCheckGroup && app.isCheckGroup.length > 0) {
                                    _.each(app.deviceList, function (item) {
                                        _.each(app.isCheckGroup, function (check) {
                                            if (item.ID == check) {
                                                app.isCheckgroup = true;
                                            }
                                        })
                                        var originDeviceGroups = [];
                                        _.each(app.oldDeviceGroupData, function (dev) {
                                            originDeviceGroups.push(dev.ID)
                                        })
                                        console.log(originDeviceGroups)
                                        if (!_.some(originDeviceGroups, function (group) {
                                                return group == item.ID
                                            })) {
                                            if (app.isCheckGroup.indexOf(item.ID
                                                    .toString()) !== -1) {
                                                item.Enable = false;
                                                item.EnableLabel = app.i18ns.upgradePlan.upgradePlan_notUsed;
                                            } else {
                                                item.Enable = true;
                                                item.EnableLabel = app.i18ns.upgradePlan.upgradePlan_usedPlan;
                                            }
                                        } else {
                                            item.Enable = false;
                                            item.EnableLabel = app.i18ns.upgradePlan.upgradePlan_usedCurrentPlan;
                                        }
                                    })

                                } else {
                                    app.isCheckgroup = false;
                                    _.each(app.deviceList, function (
                                        EnableGroup) {
                                        //EnableGroupEnableGroup.Enable = true;
                                        EnableGroup.EnableLabel = app.i18ns.upgradePlan.upgradePlan_usedPlan;
                                    });
                                }
                            } else {
                                var msg = getErrorMsg(ret);
                                this.alertMsg(msg);
                            }
                        })
                    } else {
                        _.each(this.deviceList, function (
                            EnableGroup) {
                            // EnableGroupEnableGroup.Enable = false;
                            EnableGroup.EnableLabel = app.i18ns.upgradePlan.upgradePlan_notUsed;
                        });
                    }

                },

                /**
                 * 是否组可选
                 */
                checkboxGroupT: function (row, index) {
                    if (_.some(app.isCheckGroup, function (item) {
                            return item == row.ID;
                        })) {
                        return 1;
                    } else {
                        return 0;
                    }
                },

                /**
                 * 清空设备
                 */
                clearService: function () {
                    this.serviceData = [];
                },
                /**
                 * 删除已选设备
                 */
                handleDeleteS: function (row, index) {
                    this.serviceData.splice(index, 1)
                    if (this.serviceData.length <= 0 && this.groupDevices.length <= 0) {
                        this.ExecutionPolicy = "Period";
                    }
                },
                /**
                 * 添加设备
                 */
                addService: function () {
                    this.serviceDialog = true;
                    this.getSerList()
                },
                /**
                 * 设备弹窗的选择事件
                 */
                handleSelectS: function (val) {
                    this.checkedService = val;
                    this.checkedServiceNum = val.length;
                },
                /**
                 * 确定添加设备
                 */
                ensureService: function () {
                    this.serviceData = this.checkedService;
                    this.serviceDialog = false;
                },
                /**
                 * 获取设备的列表
                 */
                getSerList: function () {
                    var queryParam = {
                        BaselineInfo: {},
                        Filter: {
                            GroupIDs: [],
                            ProductTypes: [],
                            BMCIP: "",
                            Skip: 0,
                            Top: 0
                        },
                        PackageInfos: [],
                        VersionType: ""
                    }
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        queryParam.VersionType = 'Baseline';
                        queryParam.BaselineInfo.BaselineID = this.checkedBaseId;
                        var arr = []
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageName: this.uplistData[i].PackageName,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            arr.push(obj)
                        }
                        queryParam.BaselineInfo.FirmwarePackages = arr;
                    } else {
                        queryParam.VersionType = 'UpgradePackage';
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageID: this.uplistData[i].UUID,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            queryParam.PackageInfos.push(obj)
                        }
                    }
                    if (this.deviceTypeProductFlag == "Server") {
                        this.callBackSer(queryParam);
                    } else if (this.deviceTypeProductFlag == "E9000") {
                        this.callBackEnsure(queryParam)
                    } else {
                        this.callBackSer(queryParam);
                        this.callBackEnsure(queryParam)
                    }

                },
                /**
                 * 服务器设备
                 */
                callBackSer: function (queryParam) {
                    upgradePackageManage.getAllDeviceList({
                        ip: this.FDIp,
                        data: queryParam
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.serviceList = ret.data[0].data.Devices ? ret.data[0].data.Devices :
                                [];
                            app.serviceNum = ret.data[0].data['Devices@odata.count'];
                            for (var i = 0; i < app.serviceList.length; i++) {
                                if (_.some(app.serviceData, function (item) {
                                        return item.ID == app.serviceList[i].ID;
                                    })) {
                                    (function (arg) {
                                        Vue.nextTick(function () {
                                            app.$refs.serviceList.toggleRowSelection(
                                                arg, true);
                                        })
                                    })(app.serviceList[
                                        i])

                                }
                            }
                        } else {
                            var msg = getErrorMsg(ret);
                            this.alertMsg(msg);
                        }
                    })
                },
                /**
                 * 机框设备
                 */
                callBackEnsure: function (queryParam) {
                    console.log('获取机框设备')
                },
                isType: function () {
                    this.productYesE9000 = [];
                    this.productNoE9000 = [];
                    _.each(this.uplistData, function (elementBaseline) {
                        if (elementBaseline.SupportModel.indexOf("CH121 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH121L V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH221 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH225 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH242 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX320") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH242 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX916") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX916L") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX710") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX920") === -1 && elementBaseline
                            .SupportModel.indexOf("MM920") === -1 &&
                            elementBaseline.SupportModel.indexOf("MM920_MSMB") === -1) {
                            elementBaseline.product = "Server";
                            app.productNoE9000.push("Server");
                        } else {
                            app.productYesE9000.push("E9000");
                            elementBaseline.product = "E9000";
                        }
                    });
                    if (this.productNoE9000.length > 0 && this.productYesE9000.length === 0) {
                        this.deviceTypeProductFlag = "Server";
                    } else if (this.productNoE9000.length === 0 && this.productYesE9000.length > 0) {
                        this.deviceTypeProductFlag = "E9000";
                    } else if (this.productNoE9000.length > 0 && this.productYesE9000.length > 0) {
                        this.deviceTypeProductFlag = "Combine";
                    }
                },
                /**
                 * 提交
                 */
                submitPlan: function () {
                    var queryParam = {
                        BaselineInfo: {},
                        Description: "",
                        DeviceGroupIDs: [],
                        EnclosureInfo: [],
                        ExecutionPolicy: "",
                        Name: "",
                        PackageInfos: [],
                        ResetImmediately: false,
                        SpecifiedTime: "",
                        TaskFlow: [],
                        Type: "Firmware",
                        VersionType: "",
                    };
                    queryParam.ExecutionPolicy = this.ExecutionPolicy;
                    queryParam.Name = this.upgradeForm.PlanName;
                    queryParam.Description = this.upgradeForm.Description;
                    queryParam.VersionType = this.upgradeForm.selectMethod;
                    queryParam.ResetImmediately = this.EffectPolicy;
                    if (this.ExecutionPolicy == 'SpecifiedTime') {
                        var oldDate = sessionStorage.getItem('serverDate');
                        if (this.oldTime) {
                            oldDate = this.oldTime;
                        } else {
                            oldDate = sessionStorage.getItem('serverDate');
                        }
                        var difference = (Date.parse(this.SpecifiedTime) - Date.parse(
                            (oldDate.replace(/-/g, "/")))) / 1000;
                        if (difference >= 60) {
                            queryParam.SpecifiedTime = parseTime(this.SpecifiedTime);;
                        } else {
                            app.$message({
                                message: app.i18ns.upgradePlan.upgradePlan_differenceTip.format(
                                    parseTime(this.SpecifiedTime)),
                                type: 'error'
                            });
                            return
                        }

                    } else {
                        queryParam.SpecifiedTime = ''
                    }
                    if (this.deviceData.length > 0) {
                        for (var i = 0; i < this.deviceData.length; i++) {
                            queryParam.DeviceGroupIDs.push(this.deviceData[i].ID + "")
                        }
                    }
                    if (this.serviceData.length > 0) {
                        for (var i = 0; i < this.serviceData.length; i++) {
                            var obj = {
                                BatchInterval: 0,
                                DeviceIDs: [],
                                FlowNumber: 1,
                                GroupDeviceIDs: []
                            }
                            obj.DeviceIDs.push(this.serviceData[i].ID)
                            queryParam.TaskFlow.push(obj)
                        }
                    }
                    if (this.groupDevices.length > 0) {
                        var obj = {
                            BatchInterval: 0,
                            DeviceIDs: [],
                            FlowNumber: 1,
                            GroupDeviceIDs: []
                        }
                        for (var i = 0; i < this.groupDevices.length; i++) {
                            if (queryParam.TaskFlow.length > 0) {
                                if (!_.some(queryParam.TaskFlow[0].DeviceIDs, function (item) {
                                        return item == this.groupDevices[i].ID
                                    })) {
                                    queryParam.TaskFlow[0].GroupDeviceIDs.push(this.groupDevices[i].ID)
                                }
                            } else {
                                obj.GroupDeviceIDs.push(this.groupDevices[i].ID);
                                queryParam.TaskFlow.push(obj)
                            }
                        }
                    }
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        queryParam.BaselineInfo.BaselineID = this.checkedBaseId;
                        var arr = []
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageName: this.uplistData[i].PackageName,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            arr.push(obj)
                        }
                        queryParam.BaselineInfo.FirmwarePackages = arr;
                    } else {
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageID: this.uplistData[i].ID,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            queryParam.PackageInfos.push(obj)
                        }
                    }
                    if (queryParam.ResetImmediately || queryParam.ExecutionPolicy == 'Immediate') {
                        var tips = app.i18ns.upgradePlan.upgradePlan_activeEffectTip;
                        var type = 'warning';
                        if (queryParam.ExecutionPolicy === 'Immediate' && !queryParam.ResetImmediately) {
                            type = "prompt";
                            tips = app.i18ns.upgradePlan.upgradePlan_ImedAfterEffectTip;
                        } else if (queryParam.ExecutionPolicy === 'Immediate' && queryParam.ResetImmediately) {
                            type = "warn";
                            tips = app.i18ns.upgradePlan.upgradePlan_activeImedEffectTip;
                        } else if (queryParam.ExecutionPolicy !== 'Immediate' && queryParam.ResetImmediately) {
                            type = "warn";
                            tips = app.i18ns.upgradePlan.upgradePlan_activeEffectTip;
                        }
                        this.$confirm(tips, app.i18ns.common.warn, {
                            confirmButtonText: app.i18ns.common.confirm,
                            cancelButtonText: app.i18ns.common.cancel,
                            type: type
                        }).then(function () {
                            app.ensureSubmitPlan(queryParam)
                        }).catch(function () {})
                    } else {
                        this.ensureSubmitPlan(queryParam)
                    }
                },
                /**
                 * 提交请求
                 */
                ensureSubmitPlan: function (queryParam) {
                    upgradePackageManage.updateUpgradePlanById({
                        ip: this.FDIp,
                        data: queryParam,
                        id: app.ID
                    }, function (ret) {
                        if (ret.code == '0') {
                            window.location.href = './index.html';
                        } else {
                            var msg = getErrorMsg(ret);
                            this.alertMsg(msg);
                        }
                    });
                },
                /**
                 *  返回按钮方法 
                 * **/
                back: function () {
                    window.location.href = './index.html?s=' + Math.random();
                },
                /**
                 * 获取单个组详情
                 */
                showGroupDetil: function (name) {
                    this.groupItemTit = name;
                    this.groupDialog = true;

                    upgradePackageManage.getGroupItemDetail({
                        ip: this.FDIp,
                        name: name,
                        pageNo: 1,
                        pageSize: 10
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.groupItem = ret.data[0].data.Members
                        } else {
                            var msg = getErrorMsg(ret);
                            this.alertMsg(msg);
                        }
                    })
                },
                /**
                 * 设置当前显示数据的总数
                 * 
                 * @param {any} val 
                 */
                pageInfo1HandleSizeChange: function (val) {
                    this.pageInfo1.pageSize = val;
                    if (this.pageInfo1.total > 0) {
                        if (this.pageInfo1.currentPage > 1) {
                            var startIndex = (this.pageInfo1.currentPage - 1) * this.pageInfo1.pageSize;
                            var endIndex = startIndex + this.pageInfo1.pageSize;
                            app.UpgradePackage = app.allUpgradePackageList.slice(startIndex, endIndex);
                        } else {
                            app.UpgradePackage = app.allUpgradePackageList.slice(0, this.pageInfo1.pageSize);
                        }
                    }
                },
                /**
                 * 切换当前显示页
                 * 
                 * @param {any} val 
                 */
                pageInfo1HandleCurrentChange: function (val) {
                    this.pageInfo1.currentPage = val;
                    if (this.pageInfo1.total > 0) {
                        if (this.pageInfo1.currentPage > 1) {
                            var startIndex = (this.pageInfo1.currentPage - 1) * this.pageInfo1.pageSize;
                            var endIndex = startIndex + this.pageInfo1.pageSize;
                            app.UpgradePackage = app.allUpgradePackageList.slice(startIndex, endIndex);
                        } else {
                            app.UpgradePackage = app.allUpgradePackageList.slice(0, this.pageInfo1.pageSize);
                        }
                    }
                },


                /**
                 * 设置当前显示数据的总数
                 * 
                 * @param {any} val 
                 */
                pageInfo2HandleSizeChange: function (val) {
                    this.pageInfo2.pageSize = val;
                    if (this.pageInfo2.total > 0) {
                        if (this.pageInfo2.currentPage > 1) {
                            var startIndex = (this.pageInfo2.currentPage - 1) * this.pageInfo2.pageSize;
                            var endIndex = startIndex + this.pageInfo2.pageSize;
                            app.baseLinelistData = app.allBaseLinelist.slice(startIndex, endIndex);
                        } else {
                            app.baseLinelistData = app.allBaseLinelist.slice(0, this.pageInfo2.pageSize);
                        }
                    }
                },
                /**
                 * 切换当前显示页
                 * 
                 * @param {any} val 
                 */
                pageInfo2HandleCurrentChange: function (val) {
                    this.pageInfo2.currentPage = val;
                    if (this.pageInfo2.total > 0) {
                        if (this.pageInfo2.currentPage > 1) {
                            var startIndex = (this.pageInfo2.currentPage - 1) * this.pageInfo2.pageSize;
                            var endIndex = startIndex + this.pageInfo2.pageSize;
                            app.baseLinelistData = app.allBaseLinelist.slice(startIndex, endIndex);
                        } else {
                            app.baseLinelistData = app.allBaseLinelist.slice(0, this.pageInfo2.pageSize);
                        }
                    }
                },


            }
        });
    </script>
</body>

</html>